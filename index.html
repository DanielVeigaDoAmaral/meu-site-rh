<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVA-PRO | Gest√£o de Folha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        :root {
            --bg-dark: #0f172a;
            --accent-blue: #2563eb;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-dark); 
            color: #f1f5f9;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card-dark {
            background-color: #1e293b;
            border: 1px solid #334155;
        }

        #holerite-preview-container {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            overflow-y: auto;
            padding: 2rem;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; }
            #holerite-preview-container { 
                position: static; 
                display: block !important; 
                background: white; 
                padding: 0;
            }
            .holerite-page {
                width: 190mm;
                margin: 0 auto;
                border: 1px solid #000;
                padding: 5mm;
                page-break-after: always;
                font-size: 9px !important;
            }
            .holerite-page table { font-size: 8px !important; }
        }
    </style>
</head>
<body class="antialiased">

    <!-- LOGIN -->
    <section id="auth-container" class="fixed inset-0 bg-slate-950 flex items-center justify-center p-4 z-[100]">
        <div class="bg-slate-900 w-full max-w-md rounded-3xl shadow-2xl p-8 border border-slate-800">
            <div class="text-center mb-8">
                <span class="bg-blue-600 text-white px-5 py-2 rounded-lg font-black italic tracking-tighter text-3xl shadow-lg shadow-blue-500/20">DVA-PRO</span>
                <p class="text-slate-500 text-[10px] font-bold uppercase mt-6 tracking-widest">Controle de Metalurgia</p>
            </div>
            <form id="form-login" class="space-y-4">
                <input type="text" id="login-user" placeholder="Usu√°rio" required class="w-full p-4 bg-slate-800 border border-slate-700 rounded-2xl font-bold text-white outline-none focus:ring-2 ring-blue-500">
                <input type="password" id="login-pass" placeholder="Senha" required class="w-full p-4 bg-slate-800 border border-slate-700 rounded-2xl font-bold text-white outline-none focus:ring-2 ring-blue-500">
                <button type="submit" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-black uppercase hover:bg-blue-500 transition-all shadow-xl shadow-blue-600/20">Acessar Painel</button>
            </form>
        </div>
    </section>

    <!-- APP PRINCIPAL -->
    <div id="main-app" class="hidden min-h-screen flex flex-col">
        <header class="no-print bg-slate-900 border-b border-slate-800 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="bg-blue-600 px-3 py-1 rounded font-black italic tracking-tighter">DVA-PRO</span>
                    <h1 id="topEmpresaNome" class="text-xs font-bold uppercase text-slate-400 hidden md:block">Empresa</h1>
                </div>
                <nav class="flex gap-1 md:gap-4">
                    <button onclick="showTab('tab-func')" class="px-2 py-2 text-[10px] font-black uppercase hover:text-blue-500 transition">Equipe</button>
                    <button onclick="showTab('tab-folha')" class="px-2 py-2 text-[10px] font-black uppercase hover:text-blue-500 transition">Lan√ßar</button>
                    <button onclick="showTab('tab-hist')" class="px-2 py-2 text-[10px] font-black uppercase hover:text-blue-500 transition">Hist√≥rico</button>
                    <button onclick="showTab('tab-config')" class="px-2 py-2 text-[10px] font-black uppercase hover:text-blue-500 transition">Config</button>
                    <button onclick="logout()" class="ml-2 px-3 py-1 bg-red-500/10 text-red-500 rounded-lg text-[10px] font-black uppercase">Sair</button>
                </nav>
            </div>
        </header>

        <main class="max-w-7xl mx-auto w-full p-4 md:p-8 no-print flex-grow">
            
            <!-- ABA: EQUIPE / FUNCION√ÅRIOS -->
            <section id="tab-func" class="tab-content active">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black uppercase italic italic tracking-tighter">Colaboradores</h2>
                    <button onclick="abrirModalFunc()" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-bold text-xs uppercase shadow-lg shadow-blue-600/20">+ Novo</button>
                </div>
                <div id="lista-funcionarios" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </section>

            <!-- ABA: LAN√áAR FOLHA -->
            <section id="tab-folha" class="tab-content">
                <div class="card-dark rounded-3xl p-6 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        <div class="text-center md:text-left">
                            <h2 class="text-2xl font-black uppercase italic tracking-tighter">Lan√ßamentos</h2>
                            <p class="text-[10px] text-slate-500 font-bold uppercase mt-1">DSR: <span id="regime-status" class="text-blue-400">Autom√°tico</span></p>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[9px] font-black text-slate-500 uppercase">Per√≠odo e Tipo</label>
                            <div class="flex gap-2">
                                <select id="folha-tipo" class="p-3 bg-slate-800 border border-slate-700 rounded-xl text-xs font-bold text-white outline-none w-full">
                                    <option value="mensal">MENSAL (DIA 05)</option>
                                    <option value="quinzena">ADIANTAMENTO (40%)</option>
                                </select>
                                <input type="month" id="folha-mes" class="p-3 bg-slate-800 border border-slate-700 rounded-xl text-xs font-bold text-white outline-none">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="flex flex-col gap-1">
                                <label class="text-[9px] font-black text-slate-500 uppercase">Dias √öteis (M√™s)</label>
                                <input type="number" id="cal-uteis" value="26" class="p-3 bg-slate-800 border border-slate-700 rounded-xl text-xs font-bold text-white outline-none">
                            </div>
                            <div class="flex flex-col gap-1">
                                <label class="text-[9px] font-black text-slate-500 uppercase">Dias DSR (M√™s)</label>
                                <input type="number" id="cal-dsr" value="5" class="p-3 bg-slate-800 border border-slate-700 rounded-xl text-xs font-bold text-white outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-dark rounded-3xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-[11px]">
                            <thead class="bg-slate-800/50 text-slate-500 font-black uppercase border-b border-slate-700">
                                <tr>
                                    <th class="p-5">Nome / Regime</th>
                                    <th class="p-5">Faltas (H:M)</th>
                                    <th class="p-5">Adicional Custom</th>
                                    <th class="p-5">Desconto Custom</th>
                                    <th class="p-5 text-center">A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-lancamento" class="divide-y divide-slate-800"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ABA: HIST√ìRICO -->
            <section id="tab-hist" class="tab-content">
                <div class="card-dark rounded-3xl p-6">
                    <h2 class="text-xl font-black uppercase mb-4">Holerites Gerados</h2>
                    <div id="lista-historico" class="space-y-2"></div>
                </div>
            </section>

            <!-- ABA: CONFIG -->
            <section id="tab-config" class="tab-content">
                <div class="max-w-xl mx-auto card-dark rounded-3xl p-8">
                    <h2 class="text-xl font-black uppercase mb-6">Configura√ß√µes da Empresa</h2>
                    <form id="form-empresa" class="space-y-4">
                        <input type="text" id="emp-nome" placeholder="Raz√£o Social" class="w-full p-4 bg-slate-800 border border-slate-700 rounded-2xl font-bold text-white">
                        <input type="text" id="emp-cnpj" placeholder="CNPJ" class="w-full p-4 bg-slate-800 border border-slate-700 rounded-2xl font-bold text-white">
                        <button type="submit" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-black uppercase hover:bg-blue-500 transition-all">Salvar Empresa</button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <!-- MODAL: CADASTRAR FUNCION√ÅRIO -->
    <div id="modal-func" class="fixed inset-0 bg-slate-950/80 backdrop-blur-md hidden items-center justify-center p-4 z-50">
        <div class="bg-slate-900 w-full max-w-lg rounded-3xl p-8 border border-slate-800 shadow-2xl">
            <h3 class="text-xl font-black uppercase mb-6 italic tracking-tighter">Dados do Colaborador</h3>
            <form id="form-cad-func" class="space-y-4">
                <input type="hidden" id="func-id">
                <input type="text" id="func-nome" placeholder="Nome Completo" required class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl font-bold text-white outline-none">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="func-cargo" placeholder="Cargo" required class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl font-bold text-white outline-none">
                    <select id="func-regime" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl font-bold text-white outline-none">
                        <option value="mensalista">MENSALISTA</option>
                        <option value="horista">HORISTA</option>
                    </select>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[9px] font-black text-slate-500 uppercase">Sal√°rio Mensal ou Valor/Hora</label>
                    <input type="number" id="func-salario" step="0.01" placeholder="Ex: 2000.00" required class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl font-bold text-white outline-none">
                </div>
                <div class="flex gap-4 mt-6">
                    <button type="button" onclick="fecharModalFunc()" class="flex-1 p-3 bg-slate-800 text-slate-400 rounded-xl font-black uppercase text-xs">Cancelar</button>
                    <button type="submit" class="flex-1 p-3 bg-blue-600 text-white rounded-xl font-black uppercase text-xs shadow-lg shadow-blue-600/20">Salvar Cadastro</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PREVIEW HOLERITE -->
    <div id="holerite-preview-container" class="no-print">
        <div class="max-w-4xl mx-auto flex flex-col gap-4">
            <div class="flex justify-between items-center text-white p-4 bg-slate-900 rounded-2xl border border-slate-800">
                <h2 class="text-xl font-black italic uppercase tracking-tighter">Recibo de Pagamento</h2>
                <div class="flex gap-4">
                    <button onclick="window.print()" class="bg-blue-600 px-6 py-2 rounded-xl font-bold text-xs uppercase">Imprimir / PDF</button>
                    <button onclick="closeHolerite()" class="bg-slate-800 px-6 py-2 rounded-xl font-bold text-xs uppercase">Sair</button>
                </div>
            </div>
            <div id="print-area"></div>
        </div>
    </div>

    <script>
        let db = {
            empresa: JSON.parse(localStorage.getItem('dva_emp')) || { nome: 'DVA METALURGICA', cnpj: '00.000.000/0001-00' },
            funcionarios: JSON.parse(localStorage.getItem('dva_func')) || [],
            historico: JSON.parse(localStorage.getItem('dva_hist')) || []
        };

        // --- INICIALIZA√á√ÉO ---
        function init() {
            document.getElementById('topEmpresaNome').innerText = db.empresa.nome;
            document.getElementById('emp-nome').value = db.empresa.nome;
            document.getElementById('emp-cnpj').value = db.empresa.cnpj;
            renderFuncionarios();
            renderTabelaFolha();
            renderHistorico();
        }

        // --- GEST√ÉO DE EQUIPE ---
        function renderFuncionarios() {
            const list = document.getElementById('lista-funcionarios');
            list.innerHTML = db.funcionarios.map(f => `
                <div class="card-dark p-6 rounded-3xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-2 opacity-0 group-hover:opacity-100 transition">
                        <button onclick="editarFunc('${f.id}')" class="text-blue-400 p-1">‚úèÔ∏è</button>
                        <button onclick="deletarFunc('${f.id}')" class="text-red-400 p-1">üóëÔ∏è</button>
                    </div>
                    <div class="text-[9px] font-black uppercase text-blue-500 mb-2">${f.regime || 'Mensalista'}</div>
                    <h3 class="text-lg font-black text-white uppercase leading-tight">${f.nome}</h3>
                    <p class="text-[10px] font-bold text-slate-500 uppercase italic">${f.cargo}</p>
                    <div class="mt-4 text-xs font-bold text-slate-300">
                        Base: R$ ${parseFloat(f.salario).toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                    </div>
                </div>
            `).join('');
        }

        function abrirModalFunc() {
            document.getElementById('form-cad-func').reset();
            document.getElementById('func-id').value = "";
            document.getElementById('modal-func').style.display = 'flex';
        }

        function fecharModalFunc() { document.getElementById('modal-func').style.display = 'none'; }

        document.getElementById('form-cad-func').onsubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('func-id').value || Date.now().toString();
            const novo = {
                id,
                nome: document.getElementById('func-nome').value.toUpperCase(),
                cargo: document.getElementById('func-cargo').value.toUpperCase(),
                regime: document.getElementById('func-regime').value,
                salario: parseFloat(document.getElementById('func-salario').value),
                status: 'ativos'
            };
            db.funcionarios = db.funcionarios.filter(x => x.id !== id);
            db.funcionarios.push(novo);
            salvarDB();
            fecharModalFunc();
            renderFuncionarios();
            renderTabelaFolha();
        };

        function deletarFunc(id) {
            if(confirm("Excluir colaborador?")) {
                db.funcionarios = db.funcionarios.filter(x => x.id !== id);
                salvarDB();
                renderFuncionarios();
            }
        }

        // --- LAN√áAMENTOS ---
        function renderTabelaFolha() {
            const list = document.getElementById('tabela-lancamento');
            list.innerHTML = db.funcionarios.map(f => `
                <tr class="hover:bg-slate-800/30 transition">
                    <td class="p-5">
                        <div class="font-bold text-white uppercase">${f.nome}</div>
                        <div class="text-[9px] text-slate-500 font-bold uppercase italic">${f.regime || 'Mensalista'}</div>
                    </td>
                    <td class="p-5">
                        <input type="time" id="hfa-${f.id}" class="bg-slate-800 border-none rounded-lg p-2 text-white w-20 text-xs">
                    </td>
                    <td class="p-5">
                        <div class="flex flex-col gap-1">
                            <input type="text" id="add-desc-${f.id}" placeholder="Nome Adicional" class="bg-slate-900/50 border border-slate-700 rounded-lg p-1.5 text-[10px] text-white">
                            <input type="number" id="add-val-${f.id}" placeholder="R$" class="bg-slate-900/50 border border-slate-700 rounded-lg p-1.5 text-[10px] text-blue-400">
                        </div>
                    </td>
                    <td class="p-5">
                        <div class="flex flex-col gap-1">
                            <input type="text" id="ext-desc-${f.id}" placeholder="Motivo Desconto" class="bg-slate-900/50 border border-slate-700 rounded-lg p-1.5 text-[10px] text-white">
                            <input type="number" id="ext-val-${f.id}" placeholder="R$" class="bg-slate-900/50 border border-slate-700 rounded-lg p-1.5 text-[10px] text-red-400">
                        </div>
                    </td>
                    <td class="p-5 text-center">
                        <button onclick="processar('${f.id}')" class="bg-blue-600 text-white px-5 py-2 rounded-xl text-[10px] font-black uppercase shadow-lg shadow-blue-600/20">Gravar</button>
                    </td>
                </tr>
            `).join('');
        }

        function processar(fId) {
            const f = db.funcionarios.find(x => x.id === fId);
            const mes = document.getElementById('folha-mes').value;
            const tipo = document.getElementById('folha-tipo').value;
            const uteis = parseInt(document.getElementById('cal-uteis').value) || 26;
            const dsrs = parseInt(document.getElementById('cal-dsr').value) || 5;

            if(!mes) return alert("Selecione o m√™s!");

            const hfa = document.getElementById(`hfa-${fId}`).value || "00:00";
            const [hF, mF] = hfa.split(':').map(Number);
            const totalHorasFalta = hF + (mF/60);

            const addNome = document.getElementById(`add-desc-${fId}`).value.toUpperCase() || "ADICIONAL ESPECIFICO";
            const addVal = parseFloat(document.getElementById(`add-val-${fId}`).value) || 0;
            const extNome = document.getElementById(`ext-desc-${fId}`).value.toUpperCase() || "DESCONTO ESPECIFICO";
            const extVal = parseFloat(document.getElementById(`ext-val-${fId}`).value) || 0;

            let vFalta = 0;
            let vDsrDesc = 0;
            let baseCalculo = f.salario;

            if(f.regime === 'horista') {
                const valorHora = f.salario / 220; // Assume base 220
                vFalta = totalHorasFalta * valorHora;
                vDsrDesc = (vFalta / uteis) * dsrs;
            } else {
                // Mensalista (Desconto dia ou hora sobre base fixa)
                const valorHora = f.salario / 220;
                vFalta = totalHorasFalta * valorHora;
                // Mensalistas geralmente j√° perdem o dia inteiro ou DSR fixo se faltar na semana
                vDsrDesc = totalHorasFalta > 0 ? (f.salario / 30) : 0; 
            }

            const proventos = f.salario + addVal;
            const descontos = vFalta + vDsrDesc + extVal;
            
            // INSS Simplificado
            let baseInss = proventos - (vFalta + vDsrDesc);
            let inss = baseInss * 0.09; // Simplifica√ß√£o para o exemplo

            const registro = {
                id: Date.now().toString(),
                funcId: f.id, nome: f.nome, cargo: f.cargo, mes, tipo, regime: f.regime,
                proventos: proventos,
                descontos: descontos + inss,
                liquido: proventos - (descontos + inss),
                detalhes: {
                    base: f.salario,
                    vFalta, vDsrDesc, inss, hfa,
                    extraAdd: { nome: addNome, valor: addVal },
                    extraDesc: { nome: extNome, valor: extVal }
                }
            };

            db.historico = db.historico.filter(h => !(h.funcId === fId && h.mes === mes && h.tipo === tipo));
            db.historico.push(registro);
            salvarDB();
            renderHistorico();
            alert("Processado com sucesso!");
        }

        // --- HIST√ìRICO E HOLERITE ---
        function renderHistorico() {
            const list = document.getElementById('lista-historico');
            list.innerHTML = db.historico.sort((a,b) => b.id - a.id).map(h => `
                <div class="bg-slate-800/50 p-4 rounded-2xl flex justify-between items-center border border-slate-700">
                    <div>
                        <div class="font-bold text-white text-xs uppercase">${h.nome}</div>
                        <div class="text-[9px] text-slate-500 uppercase">${h.mes} | ${h.tipo}</div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <div class="text-[10px] font-black text-blue-400">R$ ${h.liquido.toLocaleString('pt-BR', {minimumFractionDigits:2})}</div>
                        </div>
                        <button onclick="visualizarHolerite('${h.id}')" class="bg-slate-700 p-2 rounded-lg hover:bg-slate-600">üìÑ</button>
                    </div>
                </div>
            `).join('');
        }

        function visualizarHolerite(hId) {
            const h = db.historico.find(x => x.id === hId);
            
            let rows = "";
            const labelSalario = h.regime === 'horista' ? "HORAS TRABALHADAS" : "SAL√ÅRIO BASE";
            const refSalario = h.regime === 'horista' ? "220:00" : "30D";

            rows += `<tr><td class="p-1">001</td><td>${labelSalario}</td><td class="text-center">${refSalario}</td><td class="text-right">${h.detalhes.base.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td><td></td></tr>`;

            if(h.detalhes.extraAdd.valor > 0) {
                rows += `<tr><td class="p-1">050</td><td>${h.detalhes.extraAdd.nome}</td><td class="text-center"></td><td class="text-right">${h.detalhes.extraAdd.valor.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td><td></td></tr>`;
            }

            if(h.detalhes.vFalta > 0) {
                rows += `<tr><td class="p-1">910</td><td>FALTAS (DESC. DIRETO)</td><td class="text-center">${h.detalhes.hfa}</td><td></td><td class="text-right">${h.detalhes.vFalta.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td></tr>`;
                rows += `<tr><td class="p-1">911</td><td>REDU√á√ÉO DSR PROPORCIONAL</td><td class="text-center"></td><td></td><td class="text-right">${h.detalhes.vDsrDesc.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td></tr>`;
            }

            if(h.detalhes.inss > 0) {
                rows += `<tr><td class="p-1">901</td><td>INSS</td><td class="text-center"></td><td></td><td class="text-right">${h.detalhes.inss.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td></tr>`;
            }

            if(h.detalhes.extraDesc.valor > 0) {
                rows += `<tr><td class="p-1">999</td><td>${h.detalhes.extraDesc.nome}</td><td class="text-center"></td><td></td><td class="text-right">${h.detalhes.extraDesc.valor.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td></tr>`;
            }

            document.getElementById('print-area').innerHTML = `
                <div class="holerite-page flex flex-col text-black bg-white">
                    <div class="border border-black p-3 flex justify-between mb-1">
                        <div><h1 class="font-bold text-xs uppercase">${db.empresa.nome}</h1><p class="text-[8px]">CNPJ: ${db.empresa.cnpj}</p></div>
                        <div class="text-right leading-tight"><h2 class="font-bold text-[9px]">RECIBO DE PAGAMENTO</h2><p class="text-[9px]">Per√≠odo: ${h.mes}</p></div>
                    </div>
                    <div class="border border-black border-t-0 p-1 font-bold text-[8px] uppercase grid grid-cols-3">
                        <div class="col-span-2 border-r border-black p-1">Funcion√°rio: ${h.nome}</div>
                        <div class="p-1">Fun√ß√£o: ${h.cargo}</div>
                    </div>
                    <table class="w-full border border-black border-t-0 text-[8px] border-collapse">
                        <thead class="border-b border-black font-bold uppercase bg-gray-100">
                            <tr><th class="border-r border-black w-10">C√≥d</th><th class="border-r border-black text-left p-1">Descri√ß√£o</th><th class="border-r border-black w-16">Ref</th><th class="border-r border-black w-24">Vencimentos</th><th class="w-24">Descontos</th></tr>
                        </thead>
                        <tbody class="align-top">${rows}</tbody>
                        <tfoot class="border-t border-black font-bold">
                            <tr><td colspan="3" class="text-right p-1 border-r border-black">TOTAIS</td><td class="text-right border-r border-black p-1">R$ ${h.proventos.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td><td class="text-right p-1">R$ ${h.descontos.toLocaleString('pt-BR', {minimumFractionDigits:2})}</td></tr>
                        </tfoot>
                    </table>
                    <div class="mt-2 flex justify-between items-center px-1">
                        <div class="border border-black p-2"><p class="text-[7px] uppercase font-bold">Valor L√≠quido</p><p class="text-sm font-black">R$ ${h.liquido.toLocaleString('pt-BR', {minimumFractionDigits:2})}</p></div>
                        <div class="w-1/2 text-center text-[8px] border-t border-black mt-6">Assinatura do Colaborador</div>
                    </div>
                </div>
            `;
            document.getElementById('holerite-preview-container').style.display = 'block';
        }

        function closeHolerite() { document.getElementById('holerite-preview-container').style.display = 'none'; }

        // --- UTIL ---
        function salvarDB() {
            localStorage.setItem('dva_emp', JSON.stringify(db.empresa));
            localStorage.setItem('dva_func', JSON.stringify(db.funcionarios));
            localStorage.setItem('dva_hist', JSON.stringify(db.historico));
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function logout() { sessionStorage.clear(); window.location.reload(); }

        document.getElementById('form-login').onsubmit = (e) => {
            e.preventDefault();
            sessionStorage.setItem('dva_auth', 'true');
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            init();
        };

        window.onload = () => {
            if(sessionStorage.getItem('dva_auth') === 'true') {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                init();
            }
        };
    </script>
</body>
</html>
